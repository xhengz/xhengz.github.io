var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(a,r){function o(t){try{h(i.next(t))}catch(e){r(e)}}function s(t){try{h(i["throw"](t))}catch(e){r(e)}}function h(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,s)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,r&&(o=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,r=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){h.label=n[1];break}if(6===n[0]&&h.label<o[1]){h.label=o[1],o=n;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(n);break}o[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],r=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,r,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},GameContainerManager=function(){function t(){}return t.getInstance=function(){return t.instance||(this.instance=new t),this.instance},t.prototype.init=function(){this.baseContainer=this.createContainer(GameContainerConst.BASE,egret.MainContext.instance.stage),this.gameContainer=this.createContainer(GameContainerConst.GAME,this.baseContainer)},t.prototype.createContainer=function(t,e){var n=new egret.DisplayObjectContainer;return n.name=t,e?e.addChild(n):console.log("无效容器"),n},t.prototype.addLayer=function(t,e){var n=this.baseContainer.getChildByName(e);n&&n.addChild(t)},t}();__reflect(GameContainerManager.prototype,"GameContainerManager");var GameContainerConst=function(){function t(){}return t.BASE="base",t.GAME="game",t}();__reflect(GameContainerConst.prototype,"GameContainerConst");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?i(a):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return n.sent(),this.stage.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){GameContainerManager.getInstance().init(),GameManager.getInstance().init()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e.prototype.startAnimation=function(t){},e.prototype.startTetrisGame=function(){},e.prototype.onButtonClick=function(t){var e=new eui.Panel;e.title="Title",e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},e.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function a(t){e.call(i,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(i))}"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(i,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameConst=function(){function t(){}return t.START=5,t.disColor=[16777215,16711680],t.UP="UP",t.DOWN="DOWN",t.LEFT="LEFT",t.RIGHT="RIGHT",t.checkLeft=0,t.checkRight=1,t.checkDown=2,t}();__reflect(GameConst.prototype,"GameConst");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var numberToBlendMode=egret.sys.numberToBlendMode,GameManager=function(){function t(){this.mapInfo=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],this.speed=20,this.interval=0,this._moveState=GameConst.DOWN,this.isGameOver=!1,this.pointBox={x:3,y:-4}}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.init=function(){this.gameView=new GameView,this.gameView.drawNextTetrisShape()},t.prototype.update=function(){if(!this.isGameOver){if(this.interval++,this.removeShape(),this._moveState==GameConst.LEFT?this.checkMove(-1,0)&&(this.pointBox.x-=1,this._moveState=GameConst.DOWN):this._moveState==GameConst.RIGHT?this.checkMove(1,0)&&(this.pointBox.x+=1,this._moveState=GameConst.DOWN):this._moveState==GameConst.UP&&(this.transformation(),this._moveState=GameConst.DOWN),this.interval>this.speed)if(this.interval=0,this.checkMove(0,1))this.pointBox.y++;else{if(this.pushShape(),this.pointBox.y<0)return this.isGameOver=!0,void this.gameView.openGameOverPanel(!0);this.checkEliminate(),this.nextShape()}this.pushShape(),this.gameView.drawMap()}},t.prototype.resetGame=function(){this.gameView.openGameOverPanel(!1),this.nextTetrisShape=null,this.nowTetrisShape=null,this.nextShape();for(var t=0;t<this.mapInfo.length;t++)for(var e=0;e<this.mapInfo[0].length;e++)this.mapInfo[t][e]=0;this.isGameOver=!1},t.prototype.pushShape=function(){for(var t=this.nowTetrisShape.length,e=0;t>e;e++)for(var n=0;n<this.nowTetrisShape[e].length;n++){var i=e+this.pointBox.y,a=n+this.pointBox.x;0>i||i>=this.mapInfo.length||0>a||a>=this.mapInfo[i].length||(this.mapInfo[i][a]=this.nowTetrisShape[e][n]+this.mapInfo[i][a])}},t.prototype.removeShape=function(){for(var t=this.nowTetrisShape.length,e=0;t>e;e++)for(var n=0;n<this.nowTetrisShape[e].length;n++){var i=e+this.pointBox.y,a=n+this.pointBox.x;0>i||i>=this.mapInfo.length||0>a||a>=this.mapInfo[i].length||(this.mapInfo[i][a]=this.mapInfo[i][a]-this.nowTetrisShape[e][n])}},t.prototype.checkMove=function(t,e){var n,i;for(n=0;n<this.nowTetrisShape.length;n++)for(i=0;i<this.nowTetrisShape[n].length;i++)if(!(n+this.pointBox.y+e<0)){if(n+this.pointBox.y+e>=this.mapInfo.length||i+this.pointBox.x+t<0||i+this.pointBox.x+t>=this.mapInfo[0].length){if(0==this.nowTetrisShape[n][i])continue;return!1}if(this.nowTetrisShape[n][i]>0&&this.mapInfo[n+this.pointBox.y+e][i+this.pointBox.x+t]>0)return!1}return!0},t.prototype.nextShape=function(){this.pointBox.x=3,this.pointBox.y=-4,this.gameView.drawNextTetrisShape()},t.prototype.checkEliminate=function(){for(var t=0,e=this.nowTetrisShape.length,n=0;e>n;n++){var i=0,a=n+this.pointBox.y;if(a>=this.mapInfo.length)return;for(var r=0;r<this.mapInfo[a].length;r++)0!=this.mapInfo[a][r]&&(i++,i>=this.mapInfo[a].length&&(this.eliminateLine(a),t++))}this.gameView.updateScore(t)},t.prototype.eliminateLine=function(t){for(var e=t;e>0;e--)for(var n=0;n<this.mapInfo[e].length;n++){var i=this.mapInfo[e-1][n];this.mapInfo[e][n]=i}for(var n=0;n<this.mapInfo[0].length;n++)this.mapInfo[0][n]=0},t.prototype.transformation=function(){var t=this.nowTetrisShape;this.nowTetrisShape=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)this.nowTetrisShape[e][n]=t[3-n][e];this.checkMove(0,0)||(this.nowTetrisShape=t)},Object.defineProperty(t.prototype,"getMapInfo",{get:function(){return this.mapInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextShapeInfo",{get:function(){return this.nextTetrisShape},set:function(t){this.nextTetrisShape=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nowShapeInfo",{get:function(){return this.nowTetrisShape},set:function(t){this.nowTetrisShape=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moveState",{set:function(t){this._moveState=t},enumerable:!0,configurable:!0}),t}();__reflect(GameManager.prototype,"GameManager");var GameView=function(){function t(){this.totalScore=0,this.isPause=!1,this.currentPosition=0,this.initView()}return t.prototype.initView=function(){this.container=new egret.Sprite,GameContainerManager.getInstance().addLayer(this.container,GameContainerConst.GAME),this.backGroup=Main.createBitmapByName("bg_main_png"),this.container.addChild(this.backGroup),this.toolbar=Main.createBitmapByName("bg_tool_bar_png"),this.toolbar.x=0,this.toolbar.y=0,this.container.addChild(this.toolbar),this.btnQuit=Main.createBitmapByName("btn_quit_png"),this.btnQuit.x=50,this.btnQuit.y=50,this.btnQuit.$touchEnabled=!0,this.container.addChild(this.btnQuit),this.btnRank=Main.createBitmapByName("btn_rank_png"),this.btnRank.x=920,this.btnRank.y=50,this.btnRank.touchEnabled=!0,this.container.addChild(this.btnRank),this.textTitle=Main.createBitmapByName("text_title_png"),this.textTitle.x=378,this.textTitle.y=50,this.container.addChild(this.textTitle),this.bgGameFrame=Main.createBitmapByName("bg_game_frame_png"),this.bgGameFrame.x=40,this.bgGameFrame.y=220,this.container.addChild(this.bgGameFrame),this.bgGamePanel=new egret.Sprite,this.bgGamePanel.x=130,this.bgGamePanel.y=330,this.container.addChild(this.bgGamePanel),this.drawGamePanel(),this.btnPause=Main.createBitmapByName("btn_pause_png"),this.btnPause.x=767,this.btnPause.y=380,this.btnPause.touchEnabled=!0,this.container.addChild(this.btnPause),this.btnLeft=Main.createBitmapByName("btn_left_png"),this.btnLeft.x=193,this.btnLeft.y=1510,this.btnLeft.touchEnabled=!0,this.container.addChild(this.btnLeft),this.btnRight=Main.createBitmapByName("btn_right_png"),this.btnRight.x=464,this.btnRight.y=1510,this.btnRight.touchEnabled=!0,this.container.addChild(this.btnRight),this.btnRotate=Main.createBitmapByName("btn_rotate_png"),this.btnRotate.x=724,this.btnRotate.y=1510,this.btnRotate.touchEnabled=!0,this.container.addChild(this.btnRotate),this.textRemainBlock=new egret.TextField,this.textRemainBlock.text="您今日还有   块可以尽情玩耍",this.textRemainBlock.fontFamily="huakanghaibao",this.textRemainBlock.x=743,this.textRemainBlock.y=942,this.container.addChild(this.textRemainBlock),this.nextGroup=new egret.Sprite,this.nextGroup.x=750,this.nextGroup.y=583,this.container.addChild(this.nextGroup),this.mapGroup=new egret.Sprite,this.mapGroup.x=130,this.mapGroup.y=330,this.container.addChild(this.mapGroup),this.btnPlay=Main.createBitmapByName("btn_play_png"),this.btnPlay.x=270,this.btnPlay.y=878,this.btnPlay.touchEnabled=!0,this.container.addChild(this.btnPlay),this.registerControlButton(),this.btnPause.addEventListener(egret.TouchEvent.TOUCH_TAP,this.pauseHandler,this),this.btnPlay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playHandler,this)},t.prototype.playHandler=function(t){this.btnPlay.visible=!1,GameWorld.getInstance().startGame(),this.isPause&&(this.registerControlButton(),this.isPause=!this.isPause),this.soundPlay||(this.soundPlay=RES.getRes("contra_mp3")),this.soundChannel=this.soundPlay.play(this.currentPosition,0)},t.prototype.leftHandler=function(t){GameManager.getInstance().moveState=GameConst.LEFT},t.prototype.rightHandler=function(t){GameManager.getInstance().moveState=GameConst.RIGHT},t.prototype.rotateHandler=function(t){GameManager.getInstance().moveState=GameConst.UP},t.prototype.pauseHandler=function(t){GameWorld.getInstance().pauseGame(),this.unRegisterControlButton(),this.btnPlay.visible=!0,this.isPause=!this.isPause,this.soundChannel&&(this.currentPosition=this.soundChannel.position,this.soundChannel.stop())},t.prototype.registerControlButton=function(){this.btnLeft.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leftHandler,this),this.btnRight.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rightHandler,this),this.btnRotate.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rotateHandler,this)},t.prototype.unRegisterControlButton=function(){this.btnLeft.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.leftHandler,this,!1),this.btnRight.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.rightHandler,this,!1),this.btnRotate.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.rotateHandler,this,!1)},t.prototype.drawGamePanel=function(){for(var t=GameManager.getInstance().getMapInfo,e=t.length,n=0;e>n;n++)for(var i=0;i<t[n].length;i++){var a=(t[n][i],void 0);a=(n+i)%2==0?Main.createBitmapByName("cube_black_png"):Main.createBitmapByName("cube_gray_png"),a.x=a.width*i,a.y=a.height*n,this.bgGamePanel.addChild(a)}},t.prototype.drawMap=function(){this.mapGroup.removeChildren();for(var t=GameManager.getInstance().getMapInfo,e=t.length,n=0;e>n;n++)for(var i=0;i<t[n].length;i++){var a=t[n][i];if(0!=a){var r=void 0;switch(a){case 1:r=Main.createBitmapByName("cube_green_png");break;case 2:r=Main.createBitmapByName("cube_orange_png");break;case 3:r=Main.createBitmapByName("cube_red_png");break;case 4:r=Main.createBitmapByName("cube_yellow_png")}r.x=r.width*i,r.y=r.height*n,this.mapGroup.addChild(r)}}},t.prototype.drawNextTetrisShape=function(){this.nextGroup.removeChildren(),GameManager.getInstance().nextShapeInfo||(GameManager.getInstance().nextShapeInfo=TetrisShape.getTetrisShape()),GameManager.getInstance().nowShapeInfo=GameManager.getInstance().nextShapeInfo,GameManager.getInstance().nextShapeInfo=TetrisShape.getTetrisShape();for(var t=GameManager.getInstance().nextShapeInfo.length,e=0;t>e;e++)for(var n=0;n<GameManager.getInstance().nextShapeInfo[e].length;n++){var i=GameManager.getInstance().nextShapeInfo[e][n];if(0!=i){var a=void 0;switch(i){case 1:a=Main.createBitmapByName("cube_green_png");break;case 2:a=Main.createBitmapByName("cube_orange_png");break;case 3:a=Main.createBitmapByName("cube_red_png");break;case 4:a=Main.createBitmapByName("cube_yellow_png")}a.x=a.width*n,a.y=a.height*e,this.nextGroup.addChild(a)}}},t.prototype.updateScore=function(t){this.totalScore+=t,this.updateScoreText()},t.prototype.openGameOverPanel=function(t){},t.prototype.onResetGame=function(t){this.totalScore=0,this.updateScoreText(),this.mapGroup.removeChildren(),this.nextGroup.removeChildren(),GameManager.getInstance().resetGame(),t.stopPropagation()},t.prototype.updateScoreText=function(){},t}();__reflect(GameView.prototype,"GameView");var GameWorld=function(){function t(){}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.startGame=function(){egret.Ticker.getInstance().register(this.onEnder,this)},t.prototype.onEnder=function(){GameManager.getInstance().update()},t.prototype.pauseGame=function(){egret.Ticker.getInstance().unregister(this.onEnder,this)},t}();__reflect(GameWorld.prototype,"GameWorld");var ShapeType;!function(t){t[t.S=0]="S",t[t.Z=1]="Z",t[t.L=2]="L",t[t.J=3]="J",t[t.I=4]="I",t[t.O=5]="O",t[t.T=6]="T"}(ShapeType||(ShapeType={}));var TetrisShape=function(){function t(){}return t.getTetrisShape=function(){for(var t=Math.floor(7*Math.random()),e=Math.floor(4*Math.random())+1,n=this.shapeList[t],i=n.length,a=[],r=0;i>r;r++){a[r]=[];for(var o=0;o<n[r].length;o++)a[r][o]=[],a[r][o]=n[r][o]*e}return a},t.getCheckPoint=function(t){return this.checkPointList[t]},t.Type_I=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,1,1,1]],t.Type_O=[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],t.Type_T=[[0,0,0,0],[1,1,1,0],[0,1,0,0],[0,0,0,0]],t.Type_J=[[0,0,0,0],[0,1,1,0],[0,1,0,0],[0,1,0,0]],t.Type_L=[[0,0,0,0],[0,1,1,0],[0,0,1,0],[0,0,1,0]],t.Type_S=[[0,0,0,0],[0,1,0,0],[0,1,1,0],[0,0,1,0]],t.Type_Z=[[0,0,0,0],[0,0,1,0],[0,1,1,0],[0,1,0,0]],t.shapeList=[t.Type_S,t.Type_Z,t.Type_L,t.Type_J,t.Type_I,t.Type_O,t.Type_T],t.leftPoint=[[0,0],[1,0],[2,0],[3,0]],t.rightPoint=[[0,3],[1,3],[2,3],[3,3]],t.downPoint=[[3,0],[3,1],[3,2],[3,3]],t.checkPointList=[t.leftPoint,t.rightPoint,t.downPoint],t.dirPoint=[[-1,0],[1,0],[0,1]],t}();__reflect(TetrisShape.prototype,"TetrisShape");var DisplayUtils=function(){function t(){}return t.createRectDis=function(t){void 0===t&&(t=16777215);var e=new egret.Shape;return e.graphics.beginFill(t,1),e.graphics.drawRect(0,0,25,25),e.graphics.endFill(),e},t}();__reflect(DisplayUtils.prototype,"DisplayUtils");